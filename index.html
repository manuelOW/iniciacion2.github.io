<html>
  <head>
    <title>Estilo de pintor aleatorio con DeepAI Image API</title>
  </head>
  <body>
    <h1>Estilo de pintor aleatorio con DeepAI Image API</h1>
    <form>
      <label for="imagen">Cargar imagen:</label>
      <input type="file" id="imagen" name="imagen" accept="image/*">
      <br>
      <label for="estilo">Seleccionar estilo:</label>
      <select id="estilo" name="estilo">
        <option value="vangogh">Van Gogh</option>
        <option value="picasso">Picasso</option>
        <option value="velazquez">Velázquez</option>
      </select>
      <br>
      <button type="button" onclick="procesarImagen()">Procesar imagen</button>
    </form>
    <div id="resultado"></div>

    <script>
      function procesarImagen() {
        // Obtener la imagen cargada
        const archivo = document.getElementById('imagen').files[0];
        if (!archivo) {
          alert('Por favor, seleccione una imagen para procesar.');
          return;
        }

        // Leer la imagen como objeto de tipo File
        const lector = new FileReader();
        lector.readAsDataURL(archivo);

        lector.onload = async () => {
          const imagenBase64 = lector.result.split(',')[1];

          // Obtener el estilo seleccionado
          const estilo = document.getElementById('estilo').value;

	var formData = new FormData();
	formData.append("image", document.getElementById('imagen').files[0])
	formData.append("text", new Blob(["Surrealismo"], {type: "text/plain"}))

          // Hacer la solicitud a DeepAI Image API
          const response = await fetch('https://api.deepai.org/api/image-editor', {
            method: 'POST',
            headers: {
              'api-key': 'fe10a5a6-bccd-410e-a138-c43f99b62ce5',
            },
            body: formData,
          });

          const data = await response.json();
		  console.log(data)

          // Mostrar el resultado en la página web
          const imagenResultado = new Image();
          imagenResultado.src = data.output_url;
          document.getElementById('resultado').innerHTML = '';

          // Crear un enlace de descarga para la imagen procesada
          const enlaceDescarga = document.createElement('a');
          enlaceDescarga.download = 'imagen-procesada.jpg';
          enlaceDescarga.href = imagenResultado.src;
          enlaceDescarga.innerHTML = 'Descargar imagen';
          document.getElementById('resultado').appendChild(imagenResultado);
          document.getElementById('resultado').appendChild(document.createElement('br'));
          document.getElementById('resultado').appendChild(enlaceDescarga);
        };
      }
    </script>
  </body>
</html>
